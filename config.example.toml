# TinyAuth User Management - Webhook Configuration
# Copy this file to /data/config.toml (or set CONFIG_PATH env var)

# Password change webhooks (array â€” define as many as you need!)
# Called after any successful password change (change, reset, signup).
# Template variables: {{.Email}}, {{.User}} (before @), {{.Domain}} (after @), {{.Password}}

# Example 1: DirectAdmin (Vimexx) email password sync
[[password_hooks]]
enabled = false
url = "https://your-server.com:2222/CMD_API_EMAIL_PW"
method = "POST"
content_type = "application/x-www-form-urlencoded"
body = "user={{.User}}&domain={{.Domain}}&passwd={{.Password}}"
timeout = 10
headers = [
  { key = "Authorization", value = "Basic base64-encoded-credentials" }
]

# Example 2: Notify an external system
# [[password_hooks]]
# enabled = false
# url = "https://hooks.example.com/password-changed"
# method = "POST"
# content_type = "application/json"
# body = '{"email":"{{.Email}}","event":"password_changed"}'
# timeout = 5
# headers = [
#   { key = "Authorization", value = "Bearer your-token" },
#   { key = "X-Source", value = "tinyauth" }
# ]

# SMS webhook
# Used for sending SMS password reset codes.
# If not configured here, falls back to SMS_WEBHOOK_* env vars.
# Template variables: {{.To}} (phone number), {{.Message}}

# SMTP configuration (overrides SMTP_* env vars when set)
# [smtp]
# host = "mail.example.com"
# port = 465
# username = "user@example.com"
# password = "secret"
# from = "noreply@example.com"

# Example: CM.com Messages API
[sms]
enabled = false
url = "https://gw.cmtelecom.com/v1.0/message"
method = "POST"
content_type = "application/json"
timeout = 15
headers = [
  { key = "Content-Type", value = "application/json" }
]
body = '''
{"messages":{"authentication":{"producttoken":"YOUR_CM_PRODUCT_TOKEN"},"msg":[{"from":{"number":"TinyAuth"},"to":[{"number":"{{.To}}"}],"body":{"type":"AUTO","content":"{{.Message}}"}}]}}
'''

# OIDC Provider (optional)
# Turns tinyauth into an identity provider for apps that support OIDC login
# (Vikunja, Gitea, Grafana, etc.)
# Endpoints are served under /oidc/ on the same port.
[oidc]
enabled = false
issuer_url = "https://auth.example.com/oidc"
key_path = "/data/oidc-keys"

[[oidc.clients]]
id = "vikunja"
secret = "change-me"
redirect_uris = ["https://todo.example.com/auth/openid/tinyauth"]
